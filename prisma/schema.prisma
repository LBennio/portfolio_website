generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(cuid())
  email    String  @unique
  name     String?
  surname  String?
  password String

  books Book[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Book {
  id    String @id @default(cuid())
  title String @unique

  userId String
  user   User   @relation(fields: [userId], references: [id])

  pages  Page[]
  covers Cover[]

  pagemarks Pagemark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("books")
}

model Cover {
  id   String    @id @default(cuid())
  side CoverSide @default(FRONT)

  bookId String
  book   Book   @relation(fields: [bookId], references: [id], onDelete: Cascade)

  @@index([bookId])
  @@map("covers")
}

model Page {
  id    String  @id @default(cuid())
  title String?

  bookId String
  book   Book   @relation(fields: [bookId], references: [id], onDelete: Cascade)

  twinId String? @unique
  twin   Page?   @relation("PageTwin", fields: [twinId], references: [id])
  twinOf Page?   @relation("PageTwin")

  footer Footer @relation(fields: [footerId], references: [id])

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  pagemarks Pagemark[]
  footerId  String
}

model Pagemark {
  id     String  @id @default(cuid())
  number Int
  note   String?

  pageId String
  page   Page    @relation(fields: [pageId], references: [id], onDelete: Cascade)
  book   Book?   @relation(fields: [bookId], references: [id])
  bookId String?
}

model Footer {
  id     String @id @default(cuid())
  note   String
  number Int    @default(autoincrement())
  pages  Page[]
}

model Term {
  id   String   @id @default(cuid())
  data String?
  type TermType @default(NOTE)
}

enum CoverSide {
  FRONT
  BACK
}

enum TermType {
  IMAGE
  DEFINITION
  NOTE
}
